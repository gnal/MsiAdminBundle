{% extends 'MsiAdminBundle::layout.html.twig' %}

{% block actions %}
    <a class="btn btn-primary btn-small" href="{{ admin.genUrl('new') }}">{{ 'Add'|trans({}, 'MsiAdminBundle') }} {{ admin.getLabel(1) }}</a>
{% endblock %}

{% block page_title %}
    {{ admin.getLabel(2) }}
{% endblock %}

{% block content %}
    <div class="cool-box">
        <form class="pull-left form-limit" method=POST action="{{ path('msi_admin_main_limit') }}">
            {{ 'Show'|trans({}, 'MsiAdminBundle') }}
            <select class="span1" name="limit">
                <option {% if app.session.get('limit') == '10' %}selected=selected{% endif %} value="10">10</option>
                <option {% if app.session.get('limit') == '25' %}selected=selected{% endif %} value="25">25</option>
                <option {% if app.session.get('limit') == '50' %}selected=selected{% endif %} value="50">50</option>
                <option {% if app.session.get('limit') == '100' %}selected=selected{% endif %} value="100">100</option>
            </select>
            {{ 'entries'|trans({}, 'MsiAdminBundle') }}
        </form>
        <form class="pull-right form-search" method=GET action="{{ admin.genUrl('index') }}">
            {% if admin.hasParent() %}<input type="hidden" value="{{ app.request.query.get('parentId') }}" name="parentId">{% endif %}
            <div class="input-append">
                <input value="{{ app.request.query.get('q') }}" name="q" type="text" class="span3 search-query"><button type="submit" class="btn btn-small"><i class="icon-search"></i> {{ 'Search'|trans({}, 'MsiAdminBundle') }}</button><a class="btn btn-small" href="{{ admin.genUrl('index', {'parentId': app.request.query.get('parentId')}, false) }}">{{ 'Reset'|trans({}, 'MsiAdminBundle') }}</a>
            </div>
        </form>
        <div class="clearfix"></div>
    </div>
    <div class="clearfix"></div>
    {{ admin.renderTable|raw }}
{% endblock %}

{% block js %}
{{ parent() }}
<script>
(function($) {
    "use strict";
    // Return a helper with preserved width of cells
    var fixHelper = function(e, ui) {
        ui.children().each(function() {
            $(this).width($(this).width());
        });
        return ui;
    };

    $("table.sortable tbody").sortable({
        helper: fixHelper
    }).disableSelection();
})(jQuery);
(function($) {
    "use strict";
    var $table = $('table.sortable');

    $table.on('sortstop', function(e, ui) {

        var disposition = [];

        $table.find('tbody tr').each(function(i, e) {
            disposition.push($(e).data('id'));
        });

        $.ajax("{{ admin.genUrl('sort') }}", {
            data: {'disposition': disposition},
        });
    });
})(jQuery);
</script>
{% endblock js %}
